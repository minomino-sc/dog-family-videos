<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ¶ ã‚ªãƒˆã¡ã‚ƒã‚“å‹•ç”» ğŸ¶</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      background: #f5f7fb;
      margin: 0;
      padding: 16px;
    }
    h1 {
      font-size: 20px;
      margin-bottom: 12px;
    }
    #searchBar {
      width: 100%;
      padding: 8px;
      margin-bottom: 12px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .video {
      background: #fff;
      border-radius: 8px;
      padding: 8px;
      margin-bottom: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    iframe, img {
      width: 100%;
      border-radius: 6px;
    }
    .title {
      font-weight: 600;
      margin-top: 6px;
    }
    .date {
      font-size: 12px;
      color: #666;
    }
    details {
      margin-bottom: 12px;
    }
    summary {
      font-weight: 600;
      cursor: pointer;
      padding: 6px;
      background: #e0e7ff;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<h1>ğŸ¶ ã‚ªãƒˆã¡ã‚ƒã‚“å‹•ç”»</h1>

<input type="text" id="searchBar" placeholder="å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ã‚¿ã‚°ã§æ¤œç´¢..." />

<div id="videos">èª­ã¿è¾¼ã¿ä¸­...</div>

<script>
async function initViewer() {
  const videosDiv = document.getElementById("videos");
  const searchInput = document.getElementById("searchBar");

  // Firestoreã‹ã‚‰å‹•ç”»ãƒªã‚¹ãƒˆå–å¾—ï¼ˆä¾‹ï¼‰
  const videoData = await getVideoList(); 

  // æ—¥ä»˜ã”ã¨ã«ã¾ã¨ã‚ã‚‹
  const grouped = {};
  videoData.forEach(v => {
    if(!grouped[v.date]) grouped[v.date] = [];
    grouped[v.date].push(v);
  });

  // HTMLä½œæˆé–¢æ•°
  function renderVideos(filter="") {
    videosDiv.innerHTML = "";
    for(const date of Object.keys(grouped).sort((a,b)=>b.localeCompare(a))) {
      const details = document.createElement("details");
      details.open = false;
      const summary = document.createElement("summary");
      summary.textContent = date + " ã®å‹•ç”»";
      details.appendChild(summary);

      grouped[date].forEach(v=>{
        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åˆ¤å®šï¼ˆã‚¿ã‚¤ãƒˆãƒ« or ã‚¿ã‚°ã«æ¤œç´¢æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼‰
        if(filter && !(
          v.title.toLowerCase().includes(filter.toLowerCase()) ||
          (v.tags && v.tags.join(" ").toLowerCase().includes(filter.toLowerCase()))
        )) return;

        const div = document.createElement("div");
        div.className = "video";

        // ã‚µãƒ ãƒã‚¤ãƒ« + å†ç”Ÿã‚¯ãƒªãƒƒã‚¯
        const thumb = document.createElement("img");
        thumb.src = `https://img.youtube.com/vi/${v.url.split('/').pop()}/hqdefault.jpg`; // YouTubeã‚µãƒ ãƒ
        thumb.style.cursor = "pointer";
        thumb.onclick = () => {
          div.innerHTML = `<iframe src="${v.url}" frameborder="0" allowfullscreen></iframe>`;
        }
        div.appendChild(thumb);

        const title = document.createElement("div");
        title.className = "title";
        title.textContent = v.title;
        div.appendChild(title);

        details.appendChild(div);
      });

      // å­å‹•ç”»ãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤º
      if(details.querySelectorAll(".video").length > 0){
        videosDiv.appendChild(details);
      }
    }
  }

  renderVideos(); // åˆæœŸè¡¨ç¤º

  // æ¤œç´¢ãƒãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
  searchInput.addEventListener("input", e=>{
    renderVideos(e.target.value);
  });
}

// ä¾‹ï¼šFirestoreã‹ã‚‰å‹•ç”»ã‚’å–å¾—ã™ã‚‹é–¢æ•°
async function getVideoList(){
  const db = firebase.firestore();
  const snapshot = await db.collection("videos").get();
  // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¾‹: { title: "æ•£æ­©å‹•ç”»", date: "2026-01-08", url: "https://www.youtube.com/embed/xxxx", tags:["æ•£æ­©","åº­"] }
  return snapshot.docs.map(doc=>doc.data());
}

initViewer();
</script>

</body>
</html>
